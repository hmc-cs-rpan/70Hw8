# Makefile for ChunkySting Tester
# 
# As usual, you can build this software by typing
#
#     make
#

# ----- Make Macros -----

CXXFLAGS    =	-g -stdlib=libc++ -std=c++11 -Wall -Wextra -pedantic 
CXX	    =	clang++

GTEST_DIR   = gtest
GTEST_OBJS  = gtest-all.o

# Flags passed to the preprocessor.
# We have no idea here whether pthreads is available in the system, so
# disable its use.
CPPFLAGS += -I. -DGTEST_HAS_PTHREAD=0

TARGETS 	    =	stringtest messagepasser
STRINGTEST_OBJS     =	chunkystring.o stringtest.o $(GTEST_OBJS)
MESSAGEPASSER_OBJS  =   chunkystring.o message-passer.o noisy-transmission.o
ALL_OBJS	    =   $(STRINGTEST_OBJS) $(MESSAGEPASSER_OBJS)


# ----- Make Rules -----

all:	$(TARGETS)

stringtest:	$(STRINGTEST_OBJS)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o $@ -lpthread $(STRINGTEST_OBJS) \

messagepasser:	$(MESSAGEPASSER_OBJS)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o $@ -lpthread $(MESSAGEPASSER_OBJS) \

clean:
	rm -f $(TARGETS) $(ALL_OBJS)

#
# Google Test Code
#
gtest-all.o : gtest/gtest.h gtest/gtest-all.cc
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c gtest/gtest-all.cc 

# ---- Dependencies (generated by typing ``clang++ -MM *.cpp'') ----

stringtest.o: stringtest.cpp chunkystring.hpp iterator-private.hpp
chunkystring.o: chunkystring.cpp chunkystring.hpp iterator-private.hpp
message-passer.o: chunkystring.cpp chunkystring.hpp iterator-private.hpp noisy-transmission.cpp noisy-transmission.hpp

